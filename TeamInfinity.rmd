---
title: "R Notebook"
output: html_notebook
---

```{r}
library(XML)
library(RSQLite)

fpath = "~/Desktop/NEU/CS5200 Database/Practicum/Practicum2/"
dbfile = "Practicum2.sqlite"

# if database file already exists, we connect to it, otherwise
# we create a new database
dbcon <- dbConnect(RSQLite::SQLite(), paste0(fpath,dbfile))
dbExecute(dbcon, "PRAGMA foreign_keys = ON")
dbListTables(dbcon)
```


```{sql connection ="dbcon"}
CREATE TABLE `Abstract` (
  `AbstractId`      Integer PRIMARY KEY AUTOINCREMENT,
  `Copyright`       Text NOT NULL
);
```

```{sql connection ="dbcon"}
CREATE TABLE `AbstractText` (
  `AbstractTextId` Integer PRIMARY KEY AUTOINCREMENT,
  `AbstractId`     Integer NOT NULL,
  `Label`          Text NOT NULL,
  `Category`       Text NOT NULL,
  `Text`           Text NOT NULL,
  CONSTRAINT AbstractText_FK0 FOREIGN KEY (AbstractId)               REFERENCES Abstract (AbstractId)      ON DELETE CASCADE
);

```


```{sql connection = "dbcon"}
CREATE TABLE `Journal` (
  `ISSN`            Text PRIMARY KEY,
  `ISSNType`        Text NOT NULL,
  `Title`           Text NOT NULL,
  `ISOAbbreviation` Text NOT NULL
);
```

```{sql connection = "dbcon"}
CREATE TABLE `JournalIssue` (
  `JournalIssueID` Integer PRIMARY KEY AUTOINCREMENT,
  `ISSN`           Text NOT NULL,
  `CitedMedium`    Text NOT NULL,
  `Volume`         Text NOT NULL,
  `Issue`          Text NOT NULL,
  `PubDate`        Date NOT NULL,
  CONSTRAINT JournalIssue_FK0 FOREIGN KEY (ISSN)         REFERENCES Journal (ISSN)      ON DELETE CASCADE
);
```

```{sql connection ="dbcon"}
CREATE TABLE `Article` (
  `PMID`         Text PRIMARY KEY,
  `ISSN`         Text NOT NULL,
  `ArticleTitle` Text NOT NULL,
  `Pagination`   Text NOT NULL,
  `AbstractID`   Integer NOT NULL,
  `Language`     Integer NOT NULL,
  `ArticleDate`  Date NOT NULL,
  CONSTRAINT Article_FK0 FOREIGN KEY (AbstractID)         REFERENCES Abstract (AbstractID)      ON DELETE CASCADE,
  CONSTRAINT Article_FK1 FOREIGN KEY (ISSN)               REFERENCES Journal (ISSN)             ON DELETE CASCADE
);
```



```{sql connection ="dbcon"}
CREATE TABLE `Elocation` (
  `ElocationID` Integer PRIMARY KEY AUTOINCREMENT,
  `PMID`        Text NOT NULL,
  `EIdTyoe`     Text NOT NULL,
  `ValidFlag`   Boolean NOT NULL,
  CONSTRAINT Elocation_FK0 FOREIGN KEY (PMID)               REFERENCES Article (PMID)      ON DELETE CASCADE
);

```

```{sql connection = "dbcon"}
CREATE TABLE `History` (
  `HistoryID` Integer PRIMARY KEY AUTOINCREMENT,
  `PMID`      Text NOT NULL,
  `PubStatus` Text NOT NULL,
  `PubDate`   Date NOT NULL,
  CONSTRAINT History_FK0 FOREIGN KEY (PMID)               REFERENCES Article (PMID)      ON DELETE CASCADE
);
```

```{sql connection = "dbcon"}
CREATE TABLE `GrantList` (
  `GrantID`       Integer PRIMARY KEY AUTOINCREMENT,
  `PMID`          Text NOT NULL,
  `Acronym`       Text NOT NULL,
  `Agency`        Text NOT NULL,
  `Country`       Text NOT NULL,
  CONSTRAINT GrantList_FK0 FOREIGN KEY (PMID)               REFERENCES Article (PMID)      ON DELETE CASCADE
);
```

```{sql connection = "dbcon"}
CREATE TABLE `PublicationType` (
  `PublicationTypeID`      Integer PRIMARY KEY AUTOINCREMENT,
  `Type`                   Text NOT NULL
);
```

```{sql connection = "dbcon"}
CREATE TABLE `PublicationTypeList` (
  `PMID`                  Text    NOT NULL,
  `PublicationTypeID`     Integer NOT NULL,
  PRIMARY KEY (PMID, PublicationTypeID)
  CONSTRAINT PublicationTypeList_FK0 FOREIGN KEY (PMID)                   REFERENCES Article (PMID)      ON DELETE CASCADE,
  CONSTRAINT PublicationTypeList_FK1 FOREIGN KEY (PublicationTypeID)      REFERENCES PublicationType (PublicationTypeID)      ON DELETE CASCADE
);
```
```{sql connection = "dbcon"}
CREATE TABLE `Author` (
  `AuthorId`         Integer PRIMARY KEY AUTOINCREMENT,
  `LastName`         Text NOT NULL,
  `ForeName`         Text NOT NULL,
  `Initials`         Text NOT NULL,
  `Affiliation`      Text NOT NULL,
  `ValidFlag`        Boolean NOT NULL,
  `CompleteFlag`     Boolean NOT NULL
);

```

```{sql connection = "dbcon"}
CREATE TABLE `ArticleAuthorMapping` (
  `PMID`     Text NOT NULL,
  `AuthorId` Integer NOT NULL,
  CONSTRAINT PublicationTypeList_FK0   FOREIGN KEY (PMID)          REFERENCES Article (PMID)      ON DELETE CASCADE,
  CONSTRAINT PArticleAuthorMapping_FK1 FOREIGN KEY (AuthorId)      REFERENCES Author (AuthorId)   ON DELETE CASCADE
);
```

```{sql connection = "dbcon"}
```
```{sql connection = "dbcon"}
```
```{sql connection = "dbcon"}
```
```{sql connection = "dbcon"}
```
```{sql connection = "dbcon"}
```
```{sql connection = "dbcon"}
```
```{sql connection = "dbcon"}
```
```{sql connection = "dbcon"}
```
```{sql connection = "dbcon"}
```

```{sql connection = "dbcon"}
drop table if exists AbstractText;
```
```{sql connection = "dbcon"}
drop table if exists Abstract;
```
```{sql connection = "dbcon"}
drop table if exists Article;
```
```{sql connection = "dbcon"}
drop table if exists ArticleAuthorMapping;
```
```{sql connection = "dbcon"}
drop table if exists Author;
```
```{sql connection = "dbcon"}
drop table if exists Elocation;
```
```{sql connection = "dbcon"}
drop table if exists GrantList;
```
```{sql connection = "dbcon"}
drop table if exists History;
```
```{sql connection = "dbcon"}
drop table if exists Journal;
```
```{sql connection = "dbcon"}
drop table if exists JournalIssue;
```
```{sql connection = "dbcon"}
drop table if exists PublicationType;
```
```{sql connection = "dbcon"}
drop table if exists PublicationTypeList;
```

```{r }
fn <- "pubmed_sample.xml"
```
